<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/dist/styles.css" />
    <title>Rivals DB</title>
  </head>
  <body>
    <script src="https://auth.magic.link/sdk"></script>
    <script src="/dist/elm.js"></script>
    <script>
      function fetchCards() {
        return fetch("/cards.json").then((res) => res.json());
      }

      const m = new Magic("pk_live_1FB57945CEA1A727");

      fetchCards().then(async (cards) => {
        const app = Elm.Main.init({ flags: cards });

        try {
          const idToken = await m.user.getIdToken();
          console.log({ idToken });
        } catch (e) {
          console.log("UOWWWWW", e);
        }

        app.ports.initiateLogin.subscribe(async (email) => {
          const did = await m.auth.loginWithMagicLink({
            email,
            redirectURI: window.location.origin,
          });
          const meta = await m.user.getMetadata();
          app.ports.signInReceiver.send({ token: did, user: meta.issuer });
        });

        app.ports.signOut.subscribe(async (redirectUri) => {
          await m.user.logout();
        });

        m.preload();

        try {
          const a = await m.auth.loginWithCredential();
          console.log({ a });
        } catch (e) {
          console.log("GOT", e);
          // Handle errors if required!
        }
      });
    </script>
  </body>
</html>
